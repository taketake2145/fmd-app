"use strict";function ownKeys(a,e){var i,t=Object.keys(a);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(a),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,i)),t}function _objectSpread(a){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(a,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})}return a}function _defineProperty(e,a,i){return a in e?Object.defineProperty(e,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[a]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var IS_TOUCH=!!("ontouchstart"in window&&"ontouchend"in window||navigator.msPointerEnabled),eventstart=IS_TOUCH?"touchstart":"mousedown",eventmove=IS_TOUCH?"touchmove":"mousemove",eventend=IS_TOUCH?"touchend":"click",eventover=IS_TOUCH?"touchstart":"mouseover",eventout=IS_TOUCH?"touchmove":"mouseout",IS_CLICK=!1,tap=function(e,a){e.on(eventstart,function(){return IS_CLICK=!0,setTimeout(function(){IS_CLICK=!1},300),!1}).on(eventmove,function(){return IS_CLICK=!1}).on(eventend,function(){return!a||!IS_CLICK&&IS_TOUCH||a($(this)),!1})},stopDblClick=function(e){IS_TOUCH&&e.on("touchend",function(e){e.preventDefault()})},stopScroll=function(e){IS_TOUCH&&e.on("touchmove",function(e){e.preventDefault()})},stopDblClickAndScroll=function(e){IS_TOUCH&&e.on("touchmove",function(e){e.preventDefault()}).on("touchend",function(e){e.preventDefault()})},arrayDelDouble=function(e,a){var i,t,e=1e3<e.length?"string"==typeof a?(i=new Map(e.map(function(e){return[e[a],e]})),Array.from(i.values())):Array.from(new Set(e)):(t=[],"string"==typeof a?e.filter(function(e){if(-1===t.indexOf(e[a]))return t.push(e[a]),e}):e.filter(function(e){if(-1===t.indexOf(e))return t.push(e),e}));return e},arrayMatch=function(e,a){var i=[];return 0<e.length&&a&&(i=e.filter(function(e){return e==a})),0<i.length&&i},arraySort=function(e,a,i){var r="string"==typeof a||"number"==typeof a?new Array(a):a,n=r.length,s=[],o=null,c=null;return"boolean"==typeof i&&!0===i?s.push(i):i&&(s=i),e.sort(function(i,t){return function e(a){return o=r[a],c=s[a]?-1:1,i[o]<t[o]?-1*c:i[o]>t[o]?c:a<n?e(a+1):0}(0)}),e},bugfixScroll=function(i){i.height();var t,r=!0,n=!1;0==i.scrollTop()&&i.scrollTop(1),i.on("scroll",function(){var e,a;e=i.scrollTop(),a=$("> :first-child",i).outerHeight(!0)-i.outerHeight(!0),a=Math.ceil(a),e<0?r=!0:r&&(t&&clearTimeout(t),t=setTimeout(function(){i.scrollTop(1),r=!1},10)),a<e?n=!0:n&&(t&&clearTimeout(t),t=setTimeout(function(){i.scrollTop(e-1),n=!1},10))})};$(function(){var e,a=new $.Event("resizestop");$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){$(window).trigger(a)},300)})}),$(function(){var e,a=new $.Event("scrollstop");$(window).on("scroll",function(){e&&clearTimeout(e),e=setTimeout(function(){$(window).trigger(a)},100)})});var voicer,getBrToNr=function(e){e=0<arguments.length&&void 0!==e?e:"";return e=(e=(e=(e=(e=(e=(e=e.replace(/(<br>|<br \/>)/gi,"\n")).replace(/&apos;/gi,"'")).replace(/&#039;/gi,"'")).replace(/&quot;/gi,'"')).replace(/&lt;/gi,"<")).replace(/&gt;/gi,">")).replace(/&amp;/gi,"&")},getHtmlSpecialChars=function(e){return e=(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#039;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")},getNowTime=function(){var e=new Date,a=e.getFullYear(),i=e.getMonth()+1,t=e.getDate(),r=e.getHours(),e=e.getMinutes();return i<10&&(i="0"+i),t<10&&(t="0"+t),r<10&&(r="0"+r),e<10&&(e="0"+e),a+"-"+i+"-"+t+"T"+r+":"+e},getNrToBr=function(e){return(0<arguments.length&&void 0!==e?e:"").replace(/\n/g,"<br>")},getParam=function(e){var a,e=e||location.href,i=[],t={};for(a in i=(e=1<e.split("?").length?e.split("?")[1]:e).split("&")){var r=i[a].split("=");2==r.length&&""!=r[1].trim()&&(t[r[0]]=r[1])}return t},isNumber=function(e){return/^[0-9]+$/.test(e)},setHover=function(e){var a;e.on(eventover,function(){var e=$(this);e.addClass("hover"),a&&clearTimeout(a),a=setTimeout(function(){e.removeClass("hover")},300)}).on(eventout,function(){$(this).removeClass("hover")}).on("click",function(){$(this).removeClass("hover")})},shareSNS=function(e,a){a=1<arguments.length&&void 0!==a?a:"";return{twitter:"https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(a),facebook:"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),line:"https://line.me/R/msg/text/?"+encodeURIComponent(a)+" "+e}},IS_LOCALSTORAGE="localStorage"in window&&null!==window.localStorage,IS_SESSIONSTORAGE="sessionStorage"in window&&null!==window.sessionStorage,storageLS=function(a,e){var i=null;if(IS_LOCALSTORAGE&&void 0!==a)if(void 0!==e)"object"===_typeof(e)?localStorage[a]=JSON.stringify(e):localStorage[a]=e;else try{i=new Function("return "+localStorage[a])()}catch(e){i=localStorage[a]}return i},storageDelLS=function(e){return void 0!==e?localStorage.removeItem(e):null},storageSS=function(a,e){var i=null;if(IS_SESSIONSTORAGE&&void 0!==a)if(void 0!==e)"object"===_typeof(e)?sessionStorage[a]=JSON.stringify(e):sessionStorage[a]=e;else try{i=new Function("return "+sessionStorage[a])()}catch(e){i=sessionStorage[a]}return i},storageDelSS=function(e){return void 0!==e?sessionStorage.removeItem(e):null},voicerGetVoice=function(a,e){var i,t,r=[],n="";if(e){for(t=0;t<voicer.ary_voice.length;t++)if(voicer.ary_voice[t].name===a){n=voicer.ary_voice[t];break}}else 0<(r=voicer.ary_voice.filter(function(e){return e.lang===a})).length&&(n=(0<(i=r.filter(function(e){return!0===e.default})).length?i:r)[0]),n="object"===_typeof(n)&&n.name?n:"";return n},voicerInit=function(e){window.speechSynthesis&&((voicer={volume:1,rate:1,pitch:1,voice:"",lang:"",name:"",ary_voice:[],ary_voice_lang:[],ary_lang:[]}).changeVoice,voicer.settiming,voicer.status_autoplay,voicer.is_autoplay,voicer.is_playing,voicer.is_pausing,voicer.is_change_setting,voicerSetVoice(e))};window.addEventListener("beforeunload",function(){speechSynthesis&&speechSynthesis.cancel()});var messaging,voicerPlay=function(e){voicer.speech&&speechSynthesis.cancel(voicer.speech),voicer.speech=new SpeechSynthesisUtterance,voicer.speech.text=e.text||"","number"==typeof e.rate&&(voicer.speech.rate=e.rate),"number"==typeof e.pitch&&(voicer.speech.pitch=e.pitch),"number"==typeof e.volume&&(voicer.speech.volume=e.volume),"object"===_typeof(e.voice)&&(voicer.speech.lang=e.voice.lang,voicer.speech.voice=e.voice),e.lang&&(voicer.speech.lang=e.lang),speechSynthesis.speak(voicer.speech),e.func&&(voicer.speech.onend=function(){e.func()})},voicerPlusMinus=function(e,a){var i,t=0,r=!0,n=!0;switch(e){case"volume":a&&(t="plus"===a?3:-3,voicer[e]=(10*voicer[e]+t)/10),(i=10*voicer[e])<=1?n=!(voicer[e]=.1):9<=i&&(r=!(voicer[e]=1));break;case"rate":a&&(t="plus"===a?3:-3,voicer[e]=(10*voicer[e]+t)/10),(i=10*voicer[e])<=4?n=!(voicer[e]=.4):13<=i&&(r=!(voicer[e]=1.3));break;case"pitch":a&&(t="plus"===a?3:-3,voicer[e]=(10*voicer[e]+t)/10),(i=10*voicer[e])<=7?n=!(voicer[e]=.7):13<=i&&(r=!(voicer[e]=1.3))}return voicer.is_playing&&("minus"===a&&n||"plus"===a&&r)&&(voicer.is_setting_change=!0,playVoice(),voicer.is_setting_change=!1),{can_plus:r,can_minus:n}},voicerSetVoice=function(i){$(".js-form-speech");var t=$("select.js-speech-lang"),e=$(".js-speech-lang-flag"),r=$("select.js-speech-voice"),a=new SpeechSynthesisUtterance;(0<t.length||0<r.length)&&(a.text="",speechSynthesis.speak(a),setTimeout(function(){var e,a="";for(voicer.ary_voice=speechSynthesis.getVoices(),arraySort(voicer.ary_voice,"name"),a='<option class="all" value="all">Anonymous</option>',e=0;e<voicer.ary_voice.length;e++)a+='<option class="'+voicer.ary_voice[e].lang+'" value="'+voicer.ary_voice[e].name+'">'+voicer.ary_voice[e].name+"</option>";for(r.html(a),arraySort(voicer.ary_voice,"lang"),voicer.ary_voice_lang=arrayDelDouble(voicer.ary_voice,"lang"),a='<option class="all" value="all">---</option>',e=0;e<voicer.ary_voice_lang.length;e++)a+='<option value="'+voicer.ary_voice_lang[e].lang+'">'+voicer.ary_voice_lang[e].lang+"</option>",voicer.ary_lang.push(voicer.ary_voice_lang[e].lang);t.html(a),0<$(".js-speech-lang-flag").length&&0<voicer.ary_lang.length&&$(".js-speech-lang-flag").each(function(){var e=$(this).attr("data-lang");arrayMatch(voicer.ary_lang,e)?$(this).attr("data-type",e):arrayMatch(voicer.ary_lang,e.replace("-","_"))?$(this).attr("data-type",e.replace("-","_")):$(this).remove()}),t.on("change",function(){var e=$(this).val();"all"===e?(voicer.voice="",voicer.lang=""):(voicer.voice=voicerGetVoice(e),voicer.lang=voicer.voice?voicer.voice.lang:""),n()}),r.on("change",function(){voicer.voice=voicerGetVoice($(this).val(),!0),voicer.lang=voicer.voice?voicer.voice.lang:"",n()}),i&&i()},100));var n=function(){var e,a,i;voicer.is_playing&&(voicer.is_setting_change=!0,playVoice(),voicer.is_setting_change=!1),$(".bugfix-safari-hide option",r).unwrap(),""===voicer.voice?(r.val("all"),t.val("all")):(a=voicer.voice.lang,i=voicer.voice.name,e=$("option."+a,r),t.val(a),$(".js-speech-lang-flag[data-type='"+a+"']").addClass("selected"),$("option",r).wrap('<span class="bugfix-safari-hide">'),e.unwrap(),1===$("option."+a+"[value='"+i+"']",r).length?r.val(i):(1<e.length?(voicer.voice=voicerGetVoice(a),r.val(voicer.voice.name)):(e=e.val(),voicer.voice=voicerGetVoice(e,!0)),voicer.lang=voicer.voice?voicer.voice.lang:"")),""!=voicer.voice&&voicer.changeVoice&&(voicer.changeVoice(voicer.voice),voicer.pitch=1,setVoicePlusMinus("pitch"))};voicer.setLang=function(e){voicer.voice=voicerGetVoice(e),voicer.lang=voicer.voice?voicer.voice.lang:"",n()},voicer.setVoice=function(e){voicer.voice=voicerGetVoice(e,!0),voicer.lang=voicer.voice?voicer.voice.lang:"",n()},e.on("click",function(){var e=$(this);return e.hasClass("selected")||(e.addClass("selected"),voicer.setLang(e.attr("data-type"))),!1})},adjustFooterText=function(){var e=$(".js-nav-text .js-nav-bar-inner"),a=$(".js-nav-new .js-nav-bar-inner"),i=$("body"),t=window.innerWidth,r=0,e=i.hasClass("view-diary-new")?a:e;e.each(function(){$("a",this).each(function(){r+=$(this).outerWidth(!0)})}),r<t?e.addClass("center"):e.removeClass("center")},changeDiary=function e(a,i){var t=$(".js-diary"),r=$(".js-link-diary-more"),n=($(".js-link-prevnext[data-type='next']"),$(".js-link-prevnext[data-type='prev']")),s=$("> span",n),n=$(".js-link-voice"),r=r.attr("data-ajax"),i="number"==typeof i?i:DIARY_NO,o="prev"===a?i+1:i-1;s.hasClass("animation-blinker")||(DIARY[o]?isViewDiary(o)?(DIARY_NO=o,$(".js-content-diary").scrollTop(0),t.css({opacity:0,top:10}),setDiary(),t.stop().animate({opacity:1,top:0},650),checkPrevNext()):0===o&&"next"===a||e(a,o):r&&""!=r&&"prev"===a?(s.addClass("animation-blinker"),getAjaxDiary(getParam(r),function(){s.removeClass("animation-blinker"),e("prev",o)})):voicer.is_playing&&(voicer.is_playing=!1,voicer.is_pausing=!1,n.removeClass("animation-blinker"),voicer.is_autoplay&&(isViewDiary(0,"learning")?(voicer.is_playing=!0,voicer.is_pausing=!0,n.addClass("animation-blinker"),DIARY_NO=0,setDiary(!0)):e("prev",0))))},changeDiaryMode=function(){var e=$("body"),a=$(".js-player"),i=$(".js-content-diary"),t=$(".js-diary-view"),r=$(".js-link-diary-nav"),n=$(".js-link-voice");e.attr("data-content",DIARY_VIEW),"new"!=DIARY_VIEW&&"topics"!=DIARY_VIEW||(DIARY_VIEW_EDIT=DIARY_VIEW),i.scrollTop(0),t.css({opacity:0}).hide().stop(),$(".js-diary-view[data-type='"+DIARY_VIEW+"']").show().animate({opacity:1},650),r.removeClass("current"),$(".js-link-diary-nav[data-type='"+DIARY_VIEW+"']").addClass("current"),"learning"===DIARY_VIEW?(n.addClass("active"),a.addClass("show")):(n.removeClass("active"),a.removeClass("show")),"feedback"!==DIARY_VIEW&&"learning"!==DIARY_VIEW&&"memo"!==DIARY_VIEW||LS.diary_view!==DIARY_VIEW&&(LS.diary_view=DIARY_VIEW,saveLS(!0)),checkPrevNext()},checkPrevNext=function(e){e="number"==typeof e?e:DIARY_NO;"new"==DIARY_VIEW||"proofreading"==DIARY_VIEW?$(".js-link-prevnext").removeClass("active"):(checkPrev(e),checkNext(e))},checkNext=function e(a){var i=$(".js-link-prevnext[data-type='next']"),a=a-1;isViewDiary(a)?i.addClass("active"):DIARY[a]?e(a):i.removeClass("active")},checkPrev=function e(a){var i=$(".js-link-prevnext[data-type='prev']"),t=a+1,a=$(".js-link-diary-more").attr("data-ajax");isViewDiary(t)?i.addClass("active"):DIARY[t]?e(t):a&&""!=a?getAjaxDiary(getParam(a),function(){isViewDiary(t)?i.addClass("active"):e(t)}):i.removeClass("active")},concatDiary=function(e){var a;e.data&&(e.count>e.end?(a=getDiaryUrl(e.condition,e.shuffle),$(".js-link-diary-more").attr("data-ajax",a)):$(".js-link-diary-more").removeAttr("data-ajax"),DIARY=DIARY.concat(e.data))},deleteDiary=function(e){var i=$(".js-content-diary"),t={};return("completely"==e&&confirm(getText("confirmDeleteDiary"))||"temporary"==e&&confirm(getText("confirm_delete")))&&(IS_CONNECTING?setMessage("connecting",1e4):(IS_CONNECTING=!0,("completely"==e?$(".js-link-delete-diary[data-type='completely']"):$(".js-link-delete-diary[data-type='temporary']")).addClass("animation-blinker"),t.ID=$(".js-diary-view[data-type='edit'] .js-diary-id").val(),t.status=e,$.ajax({url:HOME_URL+"/ajax-diary-delete/",type:"POST",data:t,timespan:5e3}).done(function(e,a){MESSAGE_CODE="success"==a?isNumber(e)&&1==+e?(i.css({opacity:0}),LS.ary_checkdiary&&0<LS.ary_checkdiary.length&&arrayMatch(LS.ary_checkdiary,t.ID)&&(LS.ary_checkdiary.some(function(e,a){e===+t.ID&&LS.ary_checkdiary.splice(a,1)}),saveLS(!0)),DIARY.splice(DIARY_NO,1),0<DIARY.length?(DIARY[DIARY_NO]||--DIARY_NO,$(".js-link-diary-nav[data-type='edit']").show()):(DIARY_VIEW="new",$("body").removeClass("view-diary").addClass("view-diary-new"),changeDiaryMode(),$(".js-link-diary-nav[data-type='edit']").hide()),setDiary(!0),i.scrollTop(1).stop().animate({opacity:1},650),"delete_success"):(sendMail("日記削除時の想定外のエラー 01",$.param(t)),"delete_error_01"):(sendMail("日記削除時の想定外のエラー 02",$.param(t)),"delete_error_02")}).fail(function(e){MESSAGE_CODE="delete_error_network"}).always(function(){IS_CONNECTING=!1,$(".js-link-delete-diary").removeClass("animation-blinker"),setMessage(MESSAGE_CODE)}))),!1},getAjaxDiary=function(e,a){var i={url:HOME_URL+"/ajax-diary/",type:"GET",dataType:"json",timespan:5e3},t=e||{};"object"===_typeof(t)&&(i.data=t),$.ajax(i).done(function(e,a){"success"==a?concatDiary(e):sendMail("読み込み時の予期せぬエラー",$.param(t))}).fail(function(e){}).always(function(){a&&a()})},getDiaryUrl=function(e,a){var i=e?e.split("?"):"",t=[],r=!1;if(2==i.length){for(var n in e="/?",t=i[1].split("&")){var s=t[n].split("=");2==s.length&&""!=s[1].trim()&&("pg"===s[0]&&(r=!0,s[1]="true"===a?2:+s[1]+1),e+=s[0]+"="+s[1]+"&")}e=e.slice(0,-1),r||(e+="&pg=2")}else 1==i.length&&(e+="?pg=2");return e},getText=function(e){var a="";switch(e){case"save_success":a="ja"===LANG?"保存しました":"Saved it.";break;case"save_error_01":case"save_error_02":a="ja"===LANG?"保存できませんでした。ログインしていることを確認してから、もう一度お試しください。":"It wasn't saved. So check whether log in and try again.";break;case"save_error_network":a="ja"===LANG?"インターネットに接続できませんでした。もう一度お試しください。":"Try again later because I couldn't connect on web.";break;case"confirmDeleteDiary":a="ja"===LANG?"この日記を完全に削除してもよろしいですか？\nこの操作は取り消しできません。":"Is it okey this diary is deleted?\nThis operation can't be canceled.";break;case"confirm_delete":a="ja"===LANG?"ほんとうに、この日記を削除してもよろしいですか？":"Is it okey this diary is deleted?";break;case"delete_success":a="ja"===LANG?"削除しました":"Deleted it.";break;case"delete_error_01":case"delete_error_02":a="ja"===LANG?"削除できなかったので、しばらくしてからもう一度お試しください。":"Try again after because it was saved.";break;case"delete_error_network":a="ja"===LANG?"インターネットに接続できませんでした。もう一度お試しください。":"Try again after because I couldn't connect on web.";break;case"select_no_lang":a="ja"===LANG?"音声の言語を選択してください（左上の設定から変更できます）。":"Select a voice lang from setting on top and left of this screen.";break;case"no_voice":a="ja"===LANG?"おっと。この端末では音声再生ができないようです。":"Oops. There is no voice for playing at this device.";break;case"label_change":a="ja"===LANG?"変更しました":"Changed the label.";break;case"no_checked_list":a="ja"===LANG?"要チェックした日記はありません。":"No checked diary";break;case"zero_hit":a="ja"===LANG?"おっと。検索条件にマッチした日記はありません。":"Oops. There is no diary which match the condition.";break;case"thanks_voice":a="ja"===LANG?"貴重なご意見、ありがとうございます！<br>また何かお気づきのことなどありましたら、何度でもお気軽にメッセージください。":"Thanks for sharing your message.<br>Take it easy to message if you notice something again.";break;case"copy_text":a="ja"===LANG?"コピーしました。":"Copy done";break;case"no_copy_text":a="ja"===LANG?"うーむ、コピーするテキストはありません。":"Umm. No copy text.";break;case"connecting":a="ja"===LANG?"処理中です。少々お待ちくださいませ。":"Processing now. Wait a second.";break;default:a=e}return a},isShow=function(){var e=!0;return LOGIN_ID!==USER_ID&&(CONFIG.status_publish&&"private"!==CONFIG.status_publish||(e=!1)),e},isViewDiary=function(e,a){var a=a||DIARY_VIEW,e="number"==typeof e?e:DIARY_NO,e=!!DIARY[e]&&!!("edit"==a||"topics"==a&&DIARY[e].diary_list&&""!=DIARY[e].diary_list||"memo"==a&&DIARY[e].diary_vocabulary&&""!=DIARY[e].diary_vocabulary||"share"==a||"feedback"==a||"learning"==a&&(""!=DIARY[e].diary_final||""!=DIARY[e].diary_fix||""!=DIARY[e].diary_proofreading_02||""!=DIARY[e].diary_proofreading_01));return e},linkDiaryClose=function(){return IS_CONNECTING?setMessage("connecting",1e4):$("body").hasClass("focusing")?($(".js-diary-view[data-type='"+DIARY_VIEW+"']").hide(),setTimeout(function(){$(".js-diary-view[data-type='"+DIARY_VIEW+"']").show(),$("body").removeClass("focusing")},100)):(""===DIARY_VIEW_TEMP&&(DIARY_VIEW_TEMP="feedback"),DIARY_VIEW=DIARY_VIEW_TEMP,changeDiaryMode(),$("body").addClass("view-diary").removeClass("view-diary-new"),adjustFooterText()),!1},linkNavBar=function(){var e=$(this);return IS_CONNECTING?setMessage("connecting",1e4):e.hasClass("current")||(DIARY_VIEW=e.attr("data-type"),changeDiaryMode()),!1},linkSettingAndSearch=function(){var i=$("body"),t=$(".js-content-diary"),r=$(".js-content-setting"),n=$(".js-content-search");$(".js-link-close-dialog").on(eventstart,closeSettingAndSearch),$(".js-link-setting, .js-link-search").on(eventstart,function(){var e=$(this).hasClass("js-link-setting")?r:n,a=$(this).hasClass("js-link-setting")?"view-setting":"view-search";return IS_CONNECTING?setMessage("connecting",1e4):(i.addClass(a),t.hide(),e.css({opacity:0}).show(),e.scrollTop(0),e.stop().animate({opacity:1},650)),0===voicer.ary_voice.length&&voicerSetVoice(function(){""!=voicer.name&&voicer.setVoice(voicer.name)}),!1})},closeSettingAndSearch=function(){var e=$("body"),a=$(".js-content-diary"),i=$(".js-content-setting"),t=$(".js-content-search");return e.removeClass("view-setting"),e.removeClass("view-search"),i.hide(),t.hide(),a.css({opacity:0}).show(),a.stop().animate({opacity:1},650),!1},markupCommonNav=function(){function e(e){return""!=(e=$("[name='message']",e).val()).trim()&&(sendMail("ご意見箱",e,!0),$("[name='message']").val(""),setMessage("thanks_voice",1e4)),0}var a=$(".js-common-nav");a.html('\n<div class="comment">\n  <form class="comment__form js-form-comment">\n    <h1 class="comment__title">\n      <span class="en">Tell me about this web app.</span>\n      <span class="ja">ご意見聞かせてください</span>\n    </h1>\n    <p class="comment__text">\n      <span class="en">Your message gives me a power to create somthing!</span>\n      <span class="ja">その一言が制作者のモチベーションを上げ、今後の制作の力になります！ぜひお気軽にコメントください。</span>\n    </p>\n    <textarea class="js-form-comment-text" name="message" value=""></textarea>\n    <p class="comment__submit-btn">\n      <a class="btn btn--02 js-form-comment-submit">\n        <span class="en">Send</span>\n        <span class="ja">送信する</span>\n      </a>\n    </p>\n  </form>\n</div>\n<ul style="display:none;" data-type="TODO">\n  <li>\n    <a href="https://www.fiveminutediary.com/about/" target="_blang">\n      <span class="en">What\'s Five Minute Diary?</span>\n      <span class="ja">Five Minute Diary のこと</span>\n    </a>\n  </li>\n</ul>\n  '),$(".js-form-comment").on("submit",function(){return e($(this)),!1}),$(".js-form-comment-submit").on("click",function(){return e($(this).closest(".js-form-comment")),!1})},playVoice=function e(a){var i,t=$(".js-diary-view[data-type='learning'] .js-diary-final"),r=$(".js-link-voice");0<voicer.ary_voice.length&&""!=voicer.voice?a?(voicer.is_playing=!1,e()):voicer.is_playing?(voicer.is_playing=!1,r.removeClass("animation-blinker"),voicer.speech&&(voicer.is_autoplay&&!voicer.is_setting_change?(voicer.is_pausing=!0,speechSynthesis.pause(voicer.speech)):(voicer.is_pausing=!1,speechSynthesis.cancel(voicer.speech),voicer.speech=null))):(voicer.is_playing=!0,r.addClass("animation-blinker"),voicer.speech?voicer.is_pausing?speechSynthesis.resume(voicer.speech):speechSynthesis.speak(voicer.speech):(speechSynthesis.cancel(voicer.speech),speechSynthesis.cancel(),voicer.speech=null,i=t.html(),""!=(i=getBrToNr(i))?voicerPlay({text:i,volume:voicer.volume,rate:voicer.rate,pitch:voicer.pitch,lang:voicer.lang,voice:voicer.voice,func:function(){voicer.speech&&(voicer.speech=null),voicer.is_playing&&voicer.is_autoplay?"all"===voicer.status_autoplay?changeDiary("prev"):setDiary():(voicer.is_playing=!1,voicer.is_pausing=!1,r.removeClass("animation-blinker"))}}):changeDiary("prev"))):voicerSetVoice(function(){0<voicer.ary_lang.length?arrayMatch(voicer.ary_lang,voicer.lang)?(voicer.setLang(voicer.lang),e(a)):setMessage("select_no_lang",6e3):setMessage("no_voice",6e3)})},saveConfig=function(i){var e=_objectSpread({},LS),t={};e.search_checked&&delete e.search_checked,e.search_shuffle&&delete e.search_shuffle,e.diary_view&&delete e.diary_view,t.login_id=LOGIN_ID,t.json=JSON.stringify(e),$.ajax({url:HOME_URL+"/config/",type:"POST",dataType:"html",data:t,cache:!1,timespan:5e3}).done(function(e,a){"success"==a?(LS.time=e.trim(),saveLS(),i&&location.reload()):sendMail("設定ファイル作成時の予期せぬエラー01",$.param(t))}).fail(function(e){sendMail("設定ファイル作成時の予期せぬエラー02",$.param(t))}).always(function(){})},saveDiary=function(){var t,e,r;switch(DIARY_VIEW){case"new":t=$(".js-diary-view[data-type='new'] .js-form-diary");break;case"edit":e=$(".js-diary-view[data-type='edit'] .js-form-diary")}return(t||e)&&(IS_CONNECTING?setMessage("connecting",1e4):(IS_CONNECTING=!0,$(".js-link-save").addClass("animation-blinker"),r=(t||e).serialize(),$.ajax({url:HOME_URL+"/ajax-diary-save/",type:"POST",data:r,cache:!1,timespan:5e3}).done(function(e,a){var i={};MESSAGE_CODE="success"==a?$.isNumeric(e)&&0<+e?((i=setDairyObject(r)).diary_id=+e,"new"==DIARY_VIEW||0===DIARY.length?(i.diary_id=+e,DIARY.unshift(i),DIARY_NO=0,setDiary(),DIARY_VIEW="edit",$("body").removeClass("view-diary-new").addClass("view-diary"),changeDiaryMode(),$(".js-link-diary-nav[data-type='edit']").show(),$("textarea, input",t).val(""),$("input[name='post_date']",t).val(getNowTime())):(DIARY[DIARY_NO]=i,setDiary()),"save_success"):0==+e?(sendMail("日記保存時の想定外のエラー01","ID=0"),"save_error_01"):(sendMail("日記保存時の想定外のエラー02",$.param(r)),"save_error_02"):(sendMail("日記保存時の想定外のエラー03",$.param(r)),"save_error_03")}).fail(function(e){MESSAGE_CODE="save_error_network"}).always(function(){var e="save_success"===MESSAGE_CODE?3500:1e4;IS_CONNECTING=!1,$(".js-link-save").removeClass("animation-blinker"),setMessage(MESSAGE_CODE,e)}))),!1},saveLS=function(e,a){var i=_objectSpread({},LS);!0===IS_SAME_ID_USER_AND_LOGIN&&(i.search_checked&&delete i.search_checked,i.search_shuffle&&delete i.search_shuffle,storageLS("fmd",i),!0===a?saveConfig(a):!0===e&&(IS_CONFIGING&&clearTimeout(IS_CONFIGING),IS_CONFIGING=setTimeout(saveConfig,2e3)))},searchCheckDiary=function(){var e=$(".js-link-search-check");return LS.ary_checkdiary&&0<LS.ary_checkdiary.length?(e.hasClass("selected")?(LS.search_checked&&delete LS.search_checked,e.removeClass("selected")):(LS.search_checked=!0,e.addClass("selected")),saveLS()):(e.removeClass("selected"),setMessage("no_checked_list",7e3)),!1},searchDiary=function(e){var a=$(".js-link-form-search"),i=$(".js-form-search [name='q']"),t=$(".js-content-diary"),r=$("body"),n={},s=i.val().trim(),o=!!(LS.search_checked&&LS.ary_checkdiary&&0<LS.ary_checkdiary.length),c=!(!LS.search_shuffle||!0!==LS.search_shuffle),l=!1,d=[],v=0;return IS_CONNECTING?setMessage("connecting",1e4):(voicer.is_playing&&playVoice(),!0===e||""==s&&!o&&!c?(l=!0,DIARY=[],DIARY_NO=0,i.val(""),o&&searchCheckDiary(),c&&searchShuffle()):(""!=s||o||c)&&(l=!0,n.q=s,o&&(n.id=LS.ary_checkdiary.join(",")),c&&(n.shuffle=1),d=DIARY,v=DIARY_NO,DIARY=[],DIARY_NO=0),IS_SAME_ID_USER_AND_LOGIN||(n.user=USER_ID),l&&(IS_CONNECTING=!0,a.addClass("animation-blinker"),getAjaxDiary(n,function(){var e=!1;IS_CONNECTING=!1,$(".js-short-message").hide(),0===DIARY.length&&(e=!0,DIARY=d,DIARY_NO=v,setMessage("zero_hit")),"learning"!==DIARY_VIEW&&(DIARY_VIEW=r.hasClass("view-diary-new")?"edit":"feedback",r.hasClass("view-diary-new")&&(r.removeClass("view-diary-new").addClass("view-diary"),$(".js-nav-common").addClass("nav-common--search")),changeDiaryMode()),setDiary(),a.removeClass("animation-blinker"),e||($(".js-short-message").hide(),closeSettingAndSearch(),t.scrollTop(0))}))),!1},searchShuffle=function(e){var a=$(".js-link-search-shuffle"),i=$(".js-link-player-shuffle");return a.hasClass("selected")?(LS.search_shuffle=!1,a.removeClass("selected"),i.removeClass("active")):(LS.search_shuffle=!0,a.addClass("selected"),i.addClass("active"),!0===e&&searchDiary()),!1},sendMail=function(e,a,i){$.ajax({url:HOME_URL+"/send-mail/",type:"POST",data:{title:e,message:a,need_login:!0===i?"no":"yes",user_id:USER_ID},timespan:5e3})},setCheckDiary=function(){var e=$(".js-link-check"),i=DIARY[DIARY_NO].diary_id;"number"==typeof i&&(LS.ary_checkdiary||(LS.ary_checkdiary=[]),LS.ary_checkdiary.some(function(e,a){e===i&&LS.ary_checkdiary.splice(a,1)}),e.hasClass("select")?(e.removeClass("select"),0===LS.ary_checkdiary.length&&$(".js-link-search-check").removeClass("selected")):(e.addClass("select"),LS.ary_checkdiary.unshift(i)),saveLS(!0))},setCopy=function(e,a){""!==(1<arguments.length&&void 0!==a?a:"").trim()?(e.select(),document.execCommand("copy"),setMessage("copy_text")):setMessage("no_copy_text")},setDairyObject=function(e){e=getParam(e);return e.post_date||(e.post_date=getNowTime()),{diary_id:e.ID?+e.ID:0,diary_time:getDiaryParam(e.post_date),diary_time_ymd:e.post_date.split("T")[0],diary_link:e.diary_link?getDiaryParam(e.diary_link):"",diary_list:e.diary_list?getDiaryParam(e.diary_list):"",diary_ja:e.diary_ja?getDiaryParam(e.diary_ja):"",diary_ja_summary:e.diary_ja_summary?getDiaryParam(e.diary_ja_summary):"",diary_en_first:e.diary_en_first?getDiaryParam(e.diary_en_first):"",diary_en_report:e.diary_en_report?getDiaryParam(e.diary_en_report):"",diary_proofreading_01:e.diary_proofreading_01?getDiaryParam(e.diary_proofreading_01):"",diary_proofreading_02:e.diary_proofreading_02?getDiaryParam(e.diary_proofreading_02):"",diary_vocabulary:e.diary_vocabulary?getDiaryParam(e.diary_vocabulary):"",diary_fix:e.diary_fix?getDiaryParam(e.diary_fix):"",diary_final:e.diary_final?getDiaryParam(e.diary_final):""}},getDiaryParam=function(e){return e&&(e=decodeURIComponent(e),e=getHtmlSpecialChars(e),e=getNrToBr(e)),e},setDiary=function(e){var a=$(".js-diary-view[data-type='edit']"),i=($(".js-diary-view[data-type='proofreading']"),$(".js-diary-view[data-type='topics']")),t=$(".js-diary-view[data-type='feedback']"),r=$(".js-diary-view[data-type='learning']"),n=$(".js-diary-view[data-type='memo']"),s=$(".js-link-check"),o=DIARY[DIARY_NO],c="";switch(o?s.addClass("active"):o=setDairyObject(),0<a.length&&($(".js-diary-id",a).val(o.diary_id),$(".js-diary-date",a).val(o.diary_time),$(".js-diary-list",a).val(getBrToNr(o.diary_list)),$(".js-diary-ja",a).val(getBrToNr(o.diary_ja)),$(".js-diary-ja-summary",a).val(getBrToNr(o.diary_ja_summary)),$(".js-diary-en-first",a).val(getBrToNr(o.diary_en_first)),$(".js-diary-en-report",a).val(getBrToNr(o.diary_en_report)),$(".js-diary-proofreading-01",a).val(getBrToNr(o.diary_proofreading_01)),$(".js-diary-proofreading-02",a).val(getBrToNr(o.diary_proofreading_02)),$(".js-diary-vocabulary",a).val(getBrToNr(o.diary_vocabulary)),$(".js-diary-fix",a).val(getBrToNr(o.diary_fix)),$(".js-diary-final",a).val(getBrToNr(o.diary_final)),$(".js-diary-list",i).html(o.diary_list)),c=""!=o.diary_ja_summary?o.diary_ja_summary:o.diary_ja,$(".js-diary-ja-summary",t).html(c),c=""==o.diary_en_report?o.diary_en_first:o.diary_en_report,$(".js-diary-en-first",t).html(c),!0){case""!=o.diary_fix:c=o.diary_fix;break;case""!=o.diary_proofreading_02:c=o.diary_proofreading_02;break;case""!=o.diary_proofreading_01:c=o.diary_proofreading_01;break;default:c=""}switch($(".js-diary-fix",t).html(c),$(".js-diary-vocabulary",t).html(o.diary_vocabulary),""==o.diary_proofreading_01&&""==o.diary_proofreading_02&&""==o.diary_fix||""!=o.diary_proofreading_01&&""==o.diary_proofreading_02&&""==o.diary_fix||""==o.diary_proofreading_01&&""!=o.diary_proofreading_02&&""==o.diary_fix||""==o.diary_proofreading_01&&""==o.diary_proofreading_02&&""!=o.diary_fix||""==o.diary_proofreading_01&&""==o.diary_proofreading_02&&""==o.diary_fix?($(".js-diary-proofreading-01",t).html("").hide(),$(".js-diary-proofreading-02",t).html("").hide()):(""!=o.diary_proofreading_01&&o.diary_fix!=o.diary_proofreading_01&&""!=c?$(".js-diary-proofreading-01",t).html(o.diary_proofreading_01).show():$(".js-diary-proofreading-01",t).html("").hide(),""!=o.diary_proofreading_02&&o.diary_proofreading_02!=o.diary_proofreading_01&&o.diary_fix!=o.diary_proofreading_02&&""!=c?$(".js-diary-proofreading-02",t).html(o.diary_proofreading_02).show():$(".js-diary-proofreading-02",t).html("").hide()),!0){case""!=o.diary_final:c=o.diary_final;break;case""!=o.diary_fix:c=o.diary_fix;break;case""!=o.diary_proofreading_02:c=o.diary_proofreading_02;break;case""!=o.diary_proofreading_01:c=o.diary_proofreading_01;break;default:c=""}$(".js-diary-final",r).html(c),$(".js-diary-vocabulary",r).html(o.diary_vocabulary),""===o.diary_vocabulary?($(".js-diary-vocabulary",r).hide(),$(".js-diary-vocabulary").closest(".js-diary-unit").hide()):($(".js-diary-vocabulary",r).show(),$(".js-diary-vocabulary").closest(".js-diary-unit").show()),$(".js-diary-vocabulary",n).html(o.diary_vocabulary),LS.ary_checkdiary||(LS.ary_checkdiary=[]),!1===arrayMatch(LS.ary_checkdiary,o.diary_id)?s.removeClass("select"):s.addClass("select"),0<+o.diary_id?$(".js-share-url").val(HOME_URL+"/?user="+USER_ID+"&id="+o.diary_id):$(".js-share-url").val(""),voicer.speech&&(speechSynthesis.cancel(voicer.speech),voicer.speech=null),$("body").hasClass("view-diary")&&voicer.is_playing&&(voicer.settiming&&clearTimeout(voicer.settiming),voicer.settiming=setTimeout(function(){playVoice(!0)},1e3)),!0===e&&checkPrevNext()},setLabel=function(){var e,a,v=$("body"),y=$(".js-label-list-name"),t="";for(a in void 0!==LS.label&&!$.isArray(LS.label)||(LS.label={}),void 0!==LS.label_hide&&!$.isArray(LS.label_hide)||(LS.label_hide=(_defineProperty(e={date:!0,list:!0,ja:!0,"en-first":!0,"proofreading-02":!0},"proofreading-02",!0),_defineProperty(e,"vocabulary",!0),_defineProperty(e,"fix",!0),_defineProperty(e,"final",!0),e)),LS.label)$(".js-diary-edit-unit[data-type='"+a+"'] .js-diary-edit-title").html(LS.label[a]);"string"==typeof LS.label.list&&y.html(LS.label.list),$(".js-diary-view[data-type='edit'] .js-diary-edit-unit").each(function(){var e=$(this),a=$(".js-diary-edit-title",e).html(),i=e.data("type"),e=" checked";"object"===_typeof(LS.label_hide)&&!0===LS.label_hide[i]&&(e="",$(".js-diary-edit-unit[data-type='"+i+"']").hide(),"vocabulary"===i?$(".js-link-diary-nav[data-type='memo']").hide():"list"===i&&$(".js-link-diary-nav[data-type='topics']").hide()),t+='\n        <div class="label__unit js-label-unit" data-show="view" data-type="'.concat(i,'">\n          <div class="label__view js-label-view">\n            <div class="label__action">\n              <input class="js-checkbox-label" type="checkbox" name="checkbox-').concat(i,'" data-type="').concat(i,'"').concat(e,'>\n            </div>\n            <div class="label__title js-label-title">\n              ').concat(a,'\n            </div>\n            <div class="label__action">\n              <a class="label__link js-link-label-change-view" data-next="edit"><span class="icon-pen"></span></a>\n            </div>\n          </div>\n          <div class="label__edit js-label-edit">\n            <div class="label__action">\n              <a class="label__link js-link-label-change-view" data-next="view"><span class="icon-close-outline"></span></a>\n            </div>\n            <div class="label__title">\n              <input type="text" name="label-title" value="">\n            </div>\n            <div class="label__action">\n              <a class="label__link js-link-label-save" data-next="view" data-type="save"><span class="icon-download"></span></a>\n            </div>\n          </div>\n        </div>\n    ')}),$(".js-label-lists").html(t);function i(e){var a=e.closest(".js-label-unit"),i=$("[name='label-title']",a),t=$(".js-label-title",a),r=$(".ja",t),n=$(".en",t),s=0<r.length&&0<n.length,o=e.attr("data-next"),c=e.attr("data-type"),l=a.attr("data-type"),d="",e="";d=(d=(s?"en"===v.attr("data-lang")?n:r:t).text()).trim(),"edit"===o?i.val(d):"save"===c&&d!=(e=(e=(e=i.val()).trim()).substr(0,30))&&(t.html(e),$(".js-diary-edit-unit[data-type='"+l+"'] .js-diary-edit-title").html(e),"list"===l&&y.html(e),setMessage("label_change"),LS.label[l]=e,saveLS(!0)),a.attr("data-show",o)}$(".js-link-label-change-view").on("click",function(){return i($(this)),!1}),$(".js-link-label-save").on("click",function(){return i($(this)),!1}),$(".js-checkbox-label").on("change",function(){var e=$(this).data("type"),a="";!0===$(this).prop("checked")?($(".js-diary-edit-unit[data-type='"+e+"']").show(),delete LS.label_hide[e]):($(".js-diary-edit-unit[data-type='"+e+"']").hide(),LS.label_hide[e]=!0),"list"===e?a="topics":"vocabulary"===e&&(a="memo"),""!=a&&(!0===LS.label_hide[e]?$(".js-link-diary-nav[data-type='"+a+"']").hide():$(".js-link-diary-nav[data-type='"+a+"']").show()),saveLS(!0)}),$(".js-link-label-reset").on("click",function(){return LS.label&&delete LS.label,LS.label_hide&&delete LS.label_hide,saveLS(!0,!0),!1})},setMessage=function(e,a){var i=1<arguments.length&&void 0!==a?a:3500,a=getText(e);"connecting"===e||"save_error_01"===e||"save_error_02"===e?$(".js-link-reload").css({visibility:"visible"}):$(".js-link-reload").css({visibility:"hidden"}),$(".js-short-message-text").html(a),$(".js-short-message").fadeIn(),messaging&&clearTimeout(messaging),messaging=setTimeout(function(){$(".js-short-message").hide()},i)},setSplash=function(e){var a="start"===e?setTimeout(function(){$(".js-splash img").animate({opacity:1},650)},300):($("body").removeClass("js-opening"),a&&clearTimeout(a),setTimeout(function(){$(".js-splash").fadeOut()},300))},setVoice=function(){var e=$(".js-link-player-loop");LS.voicer?(LS.voicer.volume&&(voicer.volume=LS.voicer.volume),LS.voicer.rate&&(voicer.rate=LS.voicer.rate),LS.voicer.pitch&&(voicer.pitch=LS.voicer.pitch),LS.voicer.lang&&(voicer.lang=LS.voicer.lang),LS.voicer.name&&(voicer.name=LS.voicer.name),LS.voicer.autoplay&&(voicer.is_autoplay="stop"!==LS.voicer.autoplay,voicer.status_autoplay=LS.voicer.autoplay)):LS.voicer={},0<voicer.ary_voice.length&&""!=voicer.name&&voicer.setVoice(voicer.name),setVoicePlusMinus($(".js-link-player-label .current").attr("data-type")),"all"===voicer.status_autoplay?e.addClass("active"):"one"===voicer.status_autoplay&&e.addClass("active").addClass("one"),voicer.changeVoice=function(e){$(".js-speech-lang-flag").removeClass("selected"),$(".js-speech-lang-flag[data-type='"+e.lang+"']").addClass("selected"),LS.voicer.name!==e.name&&(LS.voicer.name=e.name),LS.voicer.lang!==e.lang&&(LS.voicer.lang=e.lang),LS.voicer.pitch!==e.pitch&&(LS.voicer.pitch=e.pitch),saveLS(!0)},e.on(eventstart,function(){var e=$(this);switch(voicer.status_autoplay){case"all":voicer.is_autoplay=!0,voicer.status_autoplay="one",e.addClass("one");break;case"one":voicer.is_autoplay=!1,voicer.status_autoplay="stop",e.removeClass("active").removeClass("one");break;default:voicer.is_autoplay=!0,voicer.status_autoplay="all",e.addClass("active")}return LS.voicer.autoplay=voicer.status_autoplay,saveLS(),!1}),$(".js-link-player-shuffle").on(eventstart,function(){return searchShuffle(!0),!1}),$(".js-link-player-label").on(eventstart,function(){var e,a=$(".js-link-player-label .current"),i=a.next();return a.removeClass("current"),0===i.length&&(i=$(".js-player-label-type:first-child",this)),i.addClass("current"),e=i.attr("data-type"),setVoicePlusMinus(e),!1}),$(".js-link-player[data-type='plus'], .js-link-player[data-type='minus']").on(eventstart,function(){var e=$(".js-link-player-label .current").attr("data-type");return setVoicePlusMinus(e,$(this).attr("data-type")),!1}),$(".js-link-voice").on("click",function(){return"learning"===DIARY_VIEW&&playVoice(),!1})},setVoicePlusMinus=function(e,a){a=voicerPlusMinus(e,a);a.can_plus?$(".js-link-player[data-type='plus']").addClass("active"):$(".js-link-player[data-type='plus']").removeClass("active"),a.can_minus?$(".js-link-player[data-type='minus']").addClass("active"):$(".js-link-player[data-type='minus']").removeClass("active"),LS.voicer[e]=voicer[e],saveLS(!0)},setting=function(){function e(){LANG=a.val(),t.attr("data-lang",LANG),$.ajax({url:HOME_URL+"/ajax-lang/",type:"POST",data:{lang:LANG},timespan:5e3}),LS.lang=LANG,saveLS(!0)}var a=$(".js-display-lang"),i=$(".js-display-font-size"),t=$("body"),r=$("[name='publish_status']"),n=$(".js-explain-publish-status"),s=$(".js-link-diary-nav[data-type='share']"),o="2";LS.lang?(LANG=LS.lang,a.val(LANG)):(LANG="en",a.val(LANG),e()),t.attr("data-lang",LANG),a.on("change",e),LS.font_size&&(o=LS.font_size),i.val(o),t.attr("data-font-size",o),i.on("change",function(){o=i.val(),t.attr("data-font-size",o),LS.font_size=o,saveLS()}),LS.status_publish||(LS.status_publish="private"),r.val([LS.status_publish]),"private"===LS.status_publish&&(n.hide(),s.hide()),r.on("change",function(){var e=$(this).val();"private"===e?(n.hide(),s.hide()):(n.show(),s.show()),LS.status_publish=e,saveLS(!0)}),IS_TOUCH&&$(".js-form-speech-name").hide(),$(".js-form-const-url").on("click",function(e){return e.target.setSelectionRange(0,e.target.value.length),!1}),$(".js-link-reset-all-setting").on("click",function(){var e=LS.lang,a=LS.status_publish;return LS={},storageDelLS("fmd"),"string"==typeof e&&(LS.lang=e),"string"==typeof a&&(LS.status_publish=a),saveLS(!0,!0),!1})},LS="object"===_typeof(storageLS("fmd"))?storageLS("fmd"):{},temp_ls_voicer=LS.voicer,temp_ls_lang=LS.lang,temp_ls_font_size=LS.font_size,temp_ls_diary_view=LS.diary_view;CONFIG&&$.isNumeric(CONFIG.time)&&(!0===IS_SAME_ID_USER_AND_LOGIN?(!LS.time||$.isNumeric(LS.time)&&+CONFIG.time>=+LS.time)&&(3600<+CONFIG.time-+LS.time&&(CONFIG.diary_view="feedback"),LS=null,(LS=_objectSpread({},CONFIG)).voicer=temp_ls_voicer):(LS=null,(LS=_objectSpread({},CONFIG)).lang=temp_ls_lang),LS.font_size=temp_ls_font_size,LS.diary_view=temp_ls_diary_view),$(function(){var e=$(".js-diary-form-new"),a=$(".js-no-show");setSplash("start"),isShow()?(stopScroll($(".js-nav-tab")),bugfixScroll($(".js-content")),setting(),setLabel(),$(window).on("resizestop",adjustFooterText),$("body").addClass(USER_TYPE),e.html($(".js-form-diary").clone()),$(".js-diary-date",e).val(getNowTime()),$(".js-diary-form-new",e).remove(),PARAM=getParam(decodeURIComponent(location.href)),getAjaxDiary(PARAM,function(){0<DIARY.length?(DIARY_VIEW=LS.diary_view||"feedback",DIARY_VIEW_EDIT="new",-1!==location.href.indexOf("user=")&&(DIARY_VIEW="learning"),isViewDiary()?setDiary(!0):changeDiary("prev")):1<location.href.split("?").length?DIARY_VIEW="zero":(DIARY_VIEW="feedback",$(".js-link-diary-nav[data-type='edit']").hide()),$(".js-diary-view[data-type='"+DIARY_VIEW+"']").addClass("current"),$(".js-diary-nav-bar[data-type='"+DIARY_VIEW+"']").addClass("current"),changeDiaryMode(),setDiary(),adjustFooterText(),PARAM.shuffle?$(".js-link-search-shuffle").addClass("selected"):LS.search_shuffle&&!0===LS.search_shuffle&&delete LS.search_shuffle,PARAM.checked?$(".js-link-search-check").addClass("selected"):LS.search_checked&&!0===LS.search_checked&&delete LS.search_checked,setSplash("end")}),$("input, textarea").on("focus",function(){IS_TOUCH&&$("body").addClass("focusing")}).on("blur",function(){$("body").removeClass("focusing")}),voicerInit(function(){voicer?setVoice():($(".js-link-voice, .js-form-speech, .js-player").remove(),voicer={})}),markupCommonNav(),$(".js-link-form-search").on("click",searchDiary),$(".js-form-search").on("submit",searchDiary),$(".js-link-form-reset").on("click",function(){return LS.search_checked&&(LS.search_checked=!1,$(".js-link-search-check").removeClass("selected")),LS.search_shuffle&&(LS.search_shuffle=!1,$(".js-link-search-shuffle").removeClass("selected")),$(".js-form-search [name='q']").val(""),!1}),$(".js-link-diary-nav").on("click",linkNavBar),$(".js-link-prevnext").on(eventstart,function(){var e=voicer.is_playing&&voicer.is_autoplay;return IS_CONNECTING?setMessage("connecting",1e4):"new"!=DIARY_VIEW&&(e?(voicer.is_autoplay=!1,changeDiary($(this).data("type")),setTimeout(function(){voicer.is_autoplay=!0},300)):changeDiary($(this).data("type"))),!1}),$(".js-link-edit").on(eventstart,function(){return DIARY_VIEW_TEMP=DIARY_VIEW,DIARY_VIEW=DIARY_VIEW_EDIT,changeDiaryMode(),$("body").removeClass("view-diary").addClass("view-diary-new"),$(".js-nav-common").removeClass("nav-common--search"),voicer.is_playing&&playVoice(),adjustFooterText(),!1}),$(".js-link-close").on(eventstart,linkDiaryClose),$(".js-link-save").on(eventstart,saveDiary),$(".js-form-diary").on("submit",saveDiary),$(".js-link-check").on(eventstart,setCheckDiary),$(".js-link-search-check").on("click",searchCheckDiary),$(".js-link-search-shuffle").on("click",searchShuffle),$(".js-link-delete-diary").on("click",function(){return deleteDiary($(this).data("type")),!1}),$(".js-link-reset-new").on("click",function(){return $("textarea",e).val(""),$(".js-diary-date",e).val(getNowTime()),!1}),$(".js-link-copy-url").on("click",function(){return setCopy($(".js-share-url"),$(".js-share-url").val()),!1}),linkSettingAndSearch(),$(".js-short-message-link").on(eventstart,function(){return $(".js-short-message").stop().hide(),!1}),$(".js-link-reload").on("click",function(){return location.reload(),!1}),$(".js-share").on("click",function(){var e=$(".js-share-url").val(),a=$(this).attr("data-type"),e=shareSNS(e,"【Five Minute Diary】");return location.href=e[a],!1})):(setSplash("end"),a.show(),$("body").html(a),$(".js-link-home").on("click",function(){return $(this).addClass("animation-blinker"),!(location.href="/")})),setHover($(".js-nav a, .btn, .share__link, .js-link-reload")),setHover($(".js-player a").not(".js-link-player-label"))});